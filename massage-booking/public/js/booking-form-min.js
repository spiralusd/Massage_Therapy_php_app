(()=>{'use strict';document.addEventListener('DOMContentLoaded',()=>{const t={};const e=()=>{const e=new Date,n=new Date(e);n.setDate(n.getDate()+1);const a=document.getElementById('appointmentDate');a&&(a.min=e.toISOString().split('T')[0],t.dateMin=a.min,t.dateAvailableDays=a.getAttribute('data-available-days'))},n=()=>{const e=document.getElementById('appointmentDate');if(!e)return;const n=e.getAttribute('data-available-days');if(!n)return;const a=n.split(',').map(Number);e.addEventListener('input',function(){r(this,a)}),e.addEventListener('blur',function(){r(this,a)}),t.availableDays=a},r=(t,e)=>{if(!t.value)return;const n=new Date(t.value).getDay();if(!e.includes(n))alert('Sorry, appointments are not available on this day. Please select a different date.'),t.value='';else{const e=document.querySelector('input[name="duration"]:checked')?.value||'60';'function'==typeof window.fetchAvailableTimeSlots&&window.fetchAvailableTimeSlots(t.value,e)}},a=()=>{document.querySelectorAll('.radio-option').forEach(e=>{e.querySelector('input[type="radio"]').checked&&e.classList.add('selected'),e.addEventListener('click',function(){document.querySelectorAll('.radio-option').forEach(t=>t.classList.remove('selected')),this.classList.add('selected');const e=this.querySelector('input[type="radio"]');e.checked=!0,'function'==typeof window.updateSummary&&window.updateSummary();const n=document.getElementById('appointmentDate').value;n&&'function'==typeof window.fetchAvailableTimeSlots&&window.fetchAvailableTimeSlots(n,e.value),c()});const n=e.querySelector('input[type="radio"]');n&&(t[n.name]=n.checked?n.value:null)})},o=()=>{document.querySelectorAll('.checkbox-option').forEach(e=>{e.querySelector('input[type="checkbox"]').checked&&e.classList.add('selected'),e.addEventListener('click',function(){this.classList.toggle('selected');const t=this.querySelector('input[type="checkbox"]');t.checked=!t.checked,'function'==typeof window.updateSummary&&window.updateSummary(),c()})})},s=()=>{const t=document.getElementById('bookingSummary');if(!t)return;const e=document.querySelector('input[name="duration"]:checked'),n=document.querySelector('.time-slot.selected'),r=document.getElementById('appointmentDate')?.value;if(e&&n&&r){t.classList.add('visible');const a=e.value,o=e.closest('.radio-option')?.getAttribute('data-price')||'0',s=document.getElementById('summaryService');s&&(s.textContent=`${a} Minutes Massage ($${o})`);const i=Array.from(document.querySelectorAll('input[name="focus"]:checked')).map(t=>t.value),l=document.getElementById('summaryFocusAreas');l&&(l.textContent=i.length>0?i.join(', '):'No specific areas selected');const d=new Date(r).toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'}),u=document.getElementById('summaryDateTime');u&&(u.textContent=`${d} at ${n.textContent}`);const p=document.getElementById('summaryPrice');p&&(p.textContent=`$${o}`)}else t.classList.remove('visible')},i=()=>{let t=!0,e=[];const n=['fullName','email','phone','appointmentDate'];n.forEach(n=>{const a=document.getElementById(n);a&&!a.value.trim()?(a.style.borderColor='red',a.setAttribute('aria-invalid','true'),e.push(n.replace(/([A-Z])/g,' $1').trim()),t=!1):(a.style.borderColor='',a.removeAttribute('aria-invalid'))});const r=document.getElementById('email');r&&r.value.trim()&&!l(r.value)&&(r.style.borderColor='red',r.setAttribute('aria-invalid','true'),e.push('Valid Email Address'),t=!1);const a=document.getElementById('phone');a&&a.value.trim()&&!d(a.value)&&(a.style.borderColor='red',a.setAttribute('aria-invalid','true'),e.push('Valid Phone Number'),t=!1);document.querySelector('input[name="duration"]:checked')?(document.getElementById('serviceDuration').style.borderColor=''):(document.getElementById('serviceDuration').style.borderColor='red',e.push('Service Duration'),t=!1);document.querySelector('.time-slot.selected')?(document.getElementById('timeSlots').style.borderColor=''):(document.getElementById('timeSlots').style.borderColor='red',e.push('Time Slot'),t=!1);return t||u(e),t},l=t=>/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t).toLowerCase()),d=t=>/^[\d\s()+\-\.]{7,20}$/.test(t),u=t=>{const e=document.querySelectorAll('.validation-errors');e.forEach(t=>t.parentNode.removeChild(t));const n=document.createElement('div');n.className='validation-errors',n.setAttribute('role','alert'),n.innerHTML=`<h3>Please fix the following errors:</h3><ul>${t.map(t=>`<li>${t}</li>`).join('')}</ul>`;const a=document.getElementById('appointmentForm');a&&(a.firstChild?a.insertBefore(n,a.firstChild):a.appendChild(n),n.scrollIntoView({behavior:'smooth',block:'start'}),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},8e3))},c=()=>{const e=document.getElementById('appointmentForm');if(!e)return;const n=JSON.parse(sessionStorage.getItem('massageBookingFormData')||'{}');e.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], input[type="date"], select, textarea').forEach(t=>{t.id&&(n[t.id]=t.value)}),e.querySelectorAll('input[type="radio"]:checked').forEach(t=>{n[t.name]=t.value});const a={};e.querySelectorAll('input[type="checkbox"]:checked').forEach(t=>{a[t.name]||(a[t.name]=[]),a[t.name].push(t.value)}),Object.keys(a).forEach(t=>{n[t]=a[t]});const o=document.querySelector('.time-slot.selected');o&&(n.selectedTimeSlot=o.getAttribute('data-time'),n.selectedEndTime=o.getAttribute('data-end-time')),sessionStorage.setItem('massageBookingFormData',JSON.stringify(n))},p=()=>{const e=sessionStorage.getItem('massageBookingFormData');if(!e)return;try{const n=JSON.parse(e);for(const t in n){const e=document.getElementById(t);e&&'radio'!==e.type&&'checkbox'!==e.type&&(e.value=n[t])}if(n.duration){const t=document.querySelector(`input[name="duration"][value="${n.duration}"]`);if(t){t.checked=!0;const e=t.closest('.radio-option');e&&(document.querySelectorAll('.radio-option').forEach(t=>t.classList.remove('selected')),e.classList.add('selected'))}}if(n.focus&&Array.isArray(n.focus)){n.focus.forEach(t=>{const e=document.querySelector(`input[name="focus"][value="${t}"]`);if(e){e.checked=!0;const t=e.closest('.checkbox-option');t&&t.classList.add('selected')}})}if(n.appointmentDate){const t=document.getElementById('appointmentDate');t&&(t.value=n.appointmentDate,setTimeout(()=>{'function'==typeof window.fetchAvailableTimeSlots&&window.fetchAvailableTimeSlots(n.appointmentDate,n.duration||'60').then(()=>{setTimeout(()=>{const e=document.querySelector(`.time-slot[data-time="${n.selectedTimeSlot}"]`);e&&e.click()},300)})},100))}setTimeout(()=>{'function'==typeof window.updateSummary&&window.updateSummary()},500)}catch(t){console.error('Error loading form state:',t)}},m=()=>{const e=document.getElementById('appointmentForm');if(!e)return;e.reset(),document.querySelectorAll('.radio-option, .checkbox-option, .time-slot').forEach(t=>{t.classList.remove('selected')}),Object.keys(t).forEach(n=>{if('dateMin'!==n&&'dateAvailableDays'!==n&&'availableDays'!==n){const a=document.querySelector(`input[name="${n}"][value="${t[n]}"]`);if(a){a.checked=!0;const t=a.closest('.radio-option, .checkbox-option');t&&t.classList.add('selected')}}}),document.getElementById('timeSlots')&&(document.getElementById('timeSlots').innerHTML='<p>Please select a date to see available time slots.</p>');const n=document.getElementById('bookingSummary');n&&n.classList.remove('visible'),sessionStorage.removeItem('massageBookingFormData')},f=()=>{const t=document.getElementById('appointmentForm');t&&t.addEventListener('submit',function(t){t.preventDefault(),i()&&(alert('Your appointment has been booked! A confirmation email will be sent shortly.'),m())})},y=()=>{const t=document.getElementById('serviceDuration');t&&(t.setAttribute('role','radiogroup'),t.setAttribute('aria-label','Service Duration Options'));const e=document.getElementById('focusAreas');e&&(e.setAttribute('role','group'),e.setAttribute('aria-label','Focus Areas Options'));const n=document.getElementById('timeSlots');n&&(n.setAttribute('role','listbox'),n.setAttribute('aria-label','Available Time Slots'));document.querySelectorAll('input, select, textarea').forEach(t=>{t.getAttribute('aria-label')||t.getAttribute('id')||t.setAttribute('aria-label',t.getAttribute('name'))})};e(),n(),a(),o(),f(),y(),document.querySelectorAll('#appointmentForm input, #appointmentForm select, #appointmentForm textarea').forEach(t=>{t.addEventListener('change',c)}),p(),document.addEventListener('resetBookingForm',m),window.fetchAvailableTimeSlots=async function(t,e){console.log(`Fetching time slots for ${t} with duration ${e}`);const n=document.getElementById('timeSlots');if(!n)return;n.innerHTML='<p>Loading available times...</p>',setTimeout(()=>{n.innerHTML='<p>Please use the API connector to fetch available times.</p>'},1e3)},window.updateSummary=s,window.validateForm=i,window.resetForm=m,window.disableUnavailableDays=n})})();