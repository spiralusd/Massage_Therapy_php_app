document.addEventListener("DOMContentLoaded",()=>{const t=new Date,e=document.getElementById("appointmentDate");e.min=t.toISOString().split("T")[0];const n=()=>{const t=e.getAttribute("data-available-days")?.split(",").map(Number)||[1,2,3,4,5];e.addEventListener("input",function(){const e=new Date(this.value),n=e.getDay();if(!t.includes(n))alert("Sorry, appointments are not available on this day. Please select a different date."),this.value="";else{const t=document.querySelector('input[name="duration"]:checked')?.value||"60";s(this.value,t)}})},a=()=>{const t=document.querySelectorAll(".radio-option");t.forEach(n=>{n.addEventListener("click",function(){t.forEach(t=>t.classList.remove("selected")),this.classList.add("selected");const n=this.querySelector('input[type="radio"]');n.checked=!0,l();const a=e.value;a&&s(a,n.value)})})},o=()=>{document.querySelectorAll(".checkbox-option").forEach(t=>{t.addEventListener("click",function(){this.classList.toggle("selected");const t=this.querySelector('input[type="checkbox"]');t.checked=!t.checked,l()})})},s=async(t,e)=>{console.log(`Fetching time slots for ${t} with duration ${e}`);const n=document.getElementById("timeSlots");n.innerHTML="<p>Loading available times...</p>";try{await new Promise(t=>setTimeout(t,500)),n.innerHTML="";const a=9,o=17;for(let s=a;s<=o;s++){const t=`${s}:00`,a=`${s>12?s-12:s}:00 ${s>=12?"PM":"AM"}`,o=document.createElement("div");o.className="time-slot",o.setAttribute("data-time",t);const c=Math.floor(s+parseInt(e)/60),i=parseInt(e)%60,r=`${c}:${i.toString().padStart(2,"0")}`;o.setAttribute("data-end-time",r),o.textContent=a,o.addEventListener("click",function(){document.querySelectorAll(".time-slot").forEach(t=>t.classList.remove("selected")),this.classList.add("selected"),l()}),n.appendChild(o)}}catch(t){console.error("Error fetching time slots:",t),n.innerHTML="<p>Error loading available times. Please try again.</p>"}},l=()=>{const t=document.getElementById("bookingSummary"),n=document.querySelector('input[name="duration"]:checked'),a=document.querySelector(".time-slot.selected"),o=e.value;if(n&&a&&o){t.classList.add("visible");const e=n.value,s=n.closest(".radio-option").getAttribute("data-price");document.getElementById("summaryService").textContent=`${e} Minutes Massage ($${s})`;const c=Array.from(document.querySelectorAll('input[name="focus"]:checked')).map(t=>t.value);document.getElementById("summaryFocusAreas").textContent=c.length>0?c.join(", "):"No specific areas selected";const i=new Date(o).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});document.getElementById("summaryDateTime").textContent=`${i} at ${a.textContent}`,document.getElementById("summaryPrice").textContent=`$${s}`}else t.classList.remove("visible")},c=()=>{let t=!0;const e=["fullName","email","phone","appointmentDate"];return e.forEach(e=>{const n=document.getElementById(e);n.value?(n.style.borderColor="",n.removeAttribute("aria-invalid")):(n.style.borderColor="red",n.setAttribute("aria-invalid","true"),t=!1)}),document.querySelector('input[name="duration"]:checked')?document.getElementById("serviceDuration").style.borderColor="":(document.getElementById("serviceDuration").style.borderColor="red",t=!1),document.querySelector(".time-slot.selected")?document.getElementById("timeSlots").style.borderColor="":(document.getElementById("timeSlots").style.borderColor="red",t=!1),t},i=()=>{const t=document.getElementById("appointmentForm");t&&t.addEventListener("submit",function(t){t.preventDefault(),c()&&(alert("Your appointment has been booked! A confirmation email will be sent shortly."),this.reset(),document.querySelectorAll(".radio-option, .checkbox-option, .time-slot").forEach(t=>{t.classList.remove("selected")}),document.getElementById("bookingSummary").classList.remove("visible"),document.getElementById("timeSlots").innerHTML="<p>Please select a date to see available time slots.</p>")})},r=()=>{const t=document.querySelectorAll("#appointmentForm input, #appointmentForm select, #appointmentForm textarea");t.forEach(e=>{e.addEventListener("change",()=>{const e={};t.forEach(t=>{"radio"===t.type||"checkbox"===t.type?t.checked&&(e[t.name]=t.value):e[t.name]=t.value}),sessionStorage.setItem("massageBookingFormData",JSON.stringify(e))})})},d=()=>{const t=sessionStorage.getItem("massageBookingFormData");if(t){const n=JSON.parse(t);Object.keys(n).forEach(t=>{const e=document.querySelector(`[name="${t}"]`);if(e)if("radio"===e.type||"checkbox"===e.type){document.querySelector(`[name="${t}"][value="${n[t]}"]`).checked=!0;const e=element.closest(".radio-option, .checkbox-option");e&&e.classList.add("selected")}else e.value=n[t]}),n.appointmentDate&&s(n.appointmentDate,document.querySelector('input[name="duration"]:checked')?.value||"60")}},m=()=>{document.getElementById("serviceDuration").setAttribute("role","radiogroup"),document.getElementById("serviceDuration").setAttribute("aria-label","Service Duration Options"),document.getElementById("focusAreas").setAttribute("role","group"),document.getElementById("focusAreas").setAttribute("aria-label","Focus Areas Options"),document.getElementById("timeSlots").setAttribute("role","listbox"),document.getElementById("timeSlots").setAttribute("aria-label","Available Time Slots");document.querySelectorAll("input, select, textarea").forEach(t=>{t.getAttribute("aria-label")||t.getAttribute("id")||t.setAttribute("aria-label",t.getAttribute("name"))})};n(),a(),o(),i(),r(),d(),m(),window.fetchAvailableTimeSlots=s,window.updateSummary=l,window.validateForm=c,window.setAvailableDays=n,window.loadSettings=function(){return console.log("Loading settings (default implementation)"),Promise.resolve({})}});